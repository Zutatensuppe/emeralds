function base64ToArrayBuffer(n){for(var e=atob(n.substr(n.indexOf(",")+1)),t=e.length,r=new Uint8Array(t),a=0;t>a;a++)r[a]=e.charCodeAt(a);return r.buffer}function Sequencer(n){function e(n,e){var r=i.createBufferSource(),a=u[n.n||n];r.playbackRate.value=n.p||1,r.buffer=a,r.connect(o),r.start(e||0),t.c.push(r),r.onended=function(n){t.c.forEach(function(e,t,r){return e===n.srcElement?(r.splice(t,1),!1):void 0})}}var t=this,r=0,a=0,i=new(window.AudioContext||webkitAudioContext);t.a=n[5]||.2,t.b=n[0];var o=i.createGain();o.connect(i.destination);var c=null;this.c=[];var u,f,s;this.initLoops=function(n){u={},Object.keys(n[1]).forEach(function(e){i.decodeAudioData(base64ToArrayBuffer(n[1][e]),function(n){u[e]=n})}),f=n[3],f=f.map(function(e,t){var r=[];return e.forEach(function(e){var a=n[2][e];if(n[1][e.n||e])r.push(e);else if(a){r=r.concat(a[0]);for(var i=1;i<a.length;i++)f[t+i]=f[t+i].concat(a[i])}}),r})},this.initLoops(n),this.mute=function(n){n?(c&&clearInterval(c),o.gain.value=0):c=setInterval(function(){o.gain.value+=.1,o.gain.value>=1&&(o.gain.value=1,clearInterval(c),c=null)},100)},this.play=function(){var t,o=this;return o.d=setInterval(function(){s||(s=i.currentTime);for(var c=0;100>c;c++){var u=f[r];if(r>=f.length){if(n[4]){r=0,a++;continue}o.stop(!0);break}var l=s+(o.b*r+f.length*a*o.b)/1e3;if(l>i.currentTime+o.a)break;for(t=0;t<u.length;t++)e(u[t],l);r++}},500*this.a),o},this.stop=function(n){var e=this;return e.d&&(clearInterval(e.d),e.d=!1),n||e.c.forEach(function(n){n.stop()}),e.c=[],r=0,s=i.currentTime,e}}"undefined"!=typeof module&&(module.exports=Sequencer);